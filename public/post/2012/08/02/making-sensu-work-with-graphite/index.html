<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>making sensu work with graphite :: belchak.com — A blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="Like many companies, I&amp;rsquo;m sure, we&amp;rsquo;re investigating using Sensu for monitoring and Graphite for metrics collecting. The docs for making these two commuicate together over AMQP are pretty good except for one thing.
Using the docs that I&amp;rsquo;ve read, when you start up Sensu first with its default options for AMQP, and then start up Graphite to read from that queue, Graphite will crash every time it tries to create the exchange."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://belchak.com/post/2012/08/02/making-sensu-work-with-graphite/" />


<link rel="stylesheet" href="https://belchak.com/assets/style.css">

  <link rel="stylesheet" href="https://belchak.com/assets/blue.css">



<link rel="stylesheet" href="https://belchak.com/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://belchak.com/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://belchak.com/img/favicon/blue.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="making sensu work with graphite :: belchak.com — A blog" />
<meta name="twitter:description" content="Like many companies, I&amp;rsquo;m sure, we&amp;rsquo;re investigating using Sensu for monitoring and Graphite for metrics collecting. The docs for making these two commuicate together over AMQP are pretty good except for one thing.
Using the docs that I&amp;rsquo;ve read, when you start up Sensu first with its default options for AMQP, and then start up Graphite to read from that queue, Graphite will crash every time it tries to create the exchange." />
<meta name="twitter:site" content="https://belchak.com/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="making sensu work with graphite :: belchak.com — A blog">
<meta property="og:description" content="Like many companies, I&amp;rsquo;m sure, we&amp;rsquo;re investigating using Sensu for monitoring and Graphite for metrics collecting. The docs for making these two commuicate together over AMQP are pretty good except for one thing.
Using the docs that I&amp;rsquo;ve read, when you start up Sensu first with its default options for AMQP, and then start up Graphite to read from that queue, Graphite will crash every time it tries to create the exchange." />
<meta property="og:url" content="https://belchak.com/post/2012/08/02/making-sensu-work-with-graphite/" />
<meta property="og:site_name" content="making sensu work with graphite" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="sensu" /><meta property="article:section" content="graphite" />
<meta property="article:published_time" content="2012-08-02 00:00:00 &#43;0000 UTC" />







</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    belchak.com
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/post">Posts</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/post">Posts</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  <div class="post">
    <h1 class="post-title"><a href="https://belchak.com/post/2012/08/02/making-sensu-work-with-graphite/">making sensu work with graphite</a></h1>
    <div class="post-meta">
      <span class="post-date">
        2012-08-02
      </span>
      
    </div>

    

    

    <div class="post-content">
      <p>Like many companies, I&rsquo;m sure, we&rsquo;re investigating using <a href="http://www.sonian.com/cloud-monitoring-sensu/">Sensu</a> for monitoring
and <a href="http://graphite.wikidot.com/">Graphite</a> for metrics collecting. The docs for making these two commuicate together over AMQP
are pretty good except for one thing.</p>

<p>Using the docs that I&rsquo;ve read, when you start up Sensu first with its default options for AMQP, and then start up Graphite
to read from that queue, Graphite will crash every time it tries to create the exchange. The reason for this, after lots of
hair-pulling and debugging, is because Graphite is hard-coded to set up a durable exchange for its metrics, while Sensu&rsquo;s default
is to set up a non-durable exchange. <a href="http://rabbitmq.com/">RabbitMQ</a> will not allow you to create an exchange with the same name
and different options, so whichever piece of software created the exchange will work, but the other will blow up all over your
face.</p>

<p>The solution to this is pretty simple, but I haven&rsquo;t seen it documented anywhere. Simply add <code>&quot;durable&quot;: true</code> to your exchange
configuration in your Sensu config.json like so:</p>

<pre><code class="language-json">{
    &quot;handlers&quot;: {
        &quot;graphite&quot;: {
          &quot;exchange&quot;: {
            &quot;name&quot;: &quot;graphite&quot;,
            &quot;type&quot;: &quot;topic&quot;,
            &quot;key&quot;: &quot;metrics&quot;,
            &quot;durable&quot;: true
          },
          &quot;type&quot;: &quot;amqp&quot;,
          &quot;send_only_check_output&quot;: true
        },
    }
}
</code></pre>

<p>Hope that helps!</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://belchak.com/post/2016/02/28t114930&#43;0000/tips-for-new-or-not-so-new-managers/">
                <span class="button__icon">←</span>
                <span class="button__text">tips for new or not so new managers</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://belchak.com/post/2012/07/31/migrating-from-wordpress-to-octopress/">
                <span class="button__text">migrating from wordpress to octopress</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://belchak.com/assets/main.js"></script>
<script src="https://belchak.com/assets/prism.js"></script>

  
</div>

</body>
</html>
