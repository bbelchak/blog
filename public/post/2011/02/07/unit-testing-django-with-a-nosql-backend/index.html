<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>unit testing django with a nosql backend :: belchak.com — A blog</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="In my previous post about unit testing for django, I laid the groundwork for how to unit test any django application. One nice feature that django includes with its test framework is the test database syncing. Even better is if you are using South to do database migrations - it will run the migrations in your test environment for you.
However, what if you are using a NoSQL database backend like MongoDB, Cassandra, CouchDB or something similar and you aren&amp;rsquo;t using the Django ORM?"/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://belchak.com/post/2011/02/07/unit-testing-django-with-a-nosql-backend/" />


<link rel="stylesheet" href="https://belchak.com/assets/style.css">

  <link rel="stylesheet" href="https://belchak.com/assets/blue.css">



<link rel="stylesheet" href="https://belchak.com/style.css">


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://belchak.com/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="https://belchak.com/img/favicon/blue.png">



<meta name="twitter:card" content="summary" />
<meta name="twitter:title" content="unit testing django with a nosql backend :: belchak.com — A blog" />
<meta name="twitter:description" content="In my previous post about unit testing for django, I laid the groundwork for how to unit test any django application. One nice feature that django includes with its test framework is the test database syncing. Even better is if you are using South to do database migrations - it will run the migrations in your test environment for you.
However, what if you are using a NoSQL database backend like MongoDB, Cassandra, CouchDB or something similar and you aren&amp;rsquo;t using the Django ORM?" />
<meta name="twitter:site" content="https://belchak.com/" />
<meta name="twitter:creator" content="" />
<meta name="twitter:image" content="">


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="unit testing django with a nosql backend :: belchak.com — A blog">
<meta property="og:description" content="In my previous post about unit testing for django, I laid the groundwork for how to unit test any django application. One nice feature that django includes with its test framework is the test database syncing. Even better is if you are using South to do database migrations - it will run the migrations in your test environment for you.
However, what if you are using a NoSQL database backend like MongoDB, Cassandra, CouchDB or something similar and you aren&amp;rsquo;t using the Django ORM?" />
<meta property="og:url" content="https://belchak.com/post/2011/02/07/unit-testing-django-with-a-nosql-backend/" />
<meta property="og:site_name" content="unit testing django with a nosql backend" />
<meta property="og:image" content="">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:section" content="django" /><meta property="article:section" content="NoSQL" /><meta property="article:section" content="python" /><meta property="article:section" content="Technology" />
<meta property="article:published_time" content="2011-02-07 00:00:00 &#43;0000 UTC" />







</head>
<body class="">


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    belchak.com
  </div>
</a>

    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/post">Posts</a></li>
        
      
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/post">Posts</a></li>
      
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
  <div class="post">
    <h1 class="post-title"><a href="https://belchak.com/post/2011/02/07/unit-testing-django-with-a-nosql-backend/">unit testing django with a nosql backend</a></h1>
    <div class="post-meta">
      <span class="post-date">
        2011-02-07
      </span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://belchak.com/tags/django/">django</a>&nbsp;
        
          #<a href="https://belchak.com/tags/mongodb/">mongodb</a>&nbsp;
        
          #<a href="https://belchak.com/tags/nosql/">nosql</a>&nbsp;
        
          #<a href="https://belchak.com/tags/python/">python</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      <p>In my previous post about <a href="http://www.belchak.com/2011/02/05/unit-testing-your-django-application/">unit testing for django</a>, I laid the groundwork for how to unit test any django application. One nice feature that django includes with its test framework is the test database syncing. Even better is if you are using <a href="http://www.belchak.com/2011/01/27/django-database-migrations-with-south/">South</a> to do database migrations - it will run the migrations in  your test environment for you.</p>

<p>However, what if you are using a NoSQL database backend like MongoDB, Cassandra, CouchDB or something similar and you aren&rsquo;t using the Django ORM? How do you handle setting up and tearing down the database environments?</p>

<p>The good news is that Python&rsquo;s unittest framework makes this easy. You can override the <code>setUp()</code> and <code>tearDown()</code> on each TestCase that you build. Here is a snippet to get you started:</p>

<pre><code class="language-python">import pymongo
from django.test import TestCase

# It would be best to define this in a utility class somewhere
def get_db(db_name=None):
    &quot;&quot;&quot; GetDB - simple function to wrap getting a database
    connection from the connection pool.
    &quot;&quot;&quot;
    return pymongo.Connection(
            host=settings.MONGO_HOST,
            port=settings.MONGO_PORT)[getattr(
                settings, &quot;MONGO_DBNAME_PREFIX&quot;, &quot;&quot;) +
                (db_name or settings.MONGO_DBNAME)]

class MyTestCase(TestCase):
    fixtures = ['test_data.json']
    def setUp(self):
        self.db = get_db('test')
        self.db.create_collection('mytestcollection')

    def test_doc_published(self):
        # Set up a document to save
        doc = dict(text=&quot;test&quot;,
                      user_id=1)
        self.db.mytestcollection.save(doc)
        self.assertEqual(self.db.mytestcollection.find_one(
            {'user_id':1})['text'], 'test')

    def tearDown(self):
        self.db.drop_collection('mytestcollection')
</code></pre>

<p>What this does is <code>setUp()</code> a collection in the <code>mytestcollection</code> collection, runs the <code>my_doc_published</code> test and then tears down the test database environment by dropping the <code>mytestcollection</code> collection.</p>

<p>Things to remember for <code>setUp()</code> and <code>tearDown()</code>:</p>

<ul>
<li><p><code>setUp()</code> is called before every test method in your TestCase class.</p></li>

<li><p><code>tearDown()</code> is called after every test method in your TestCase class.</p></li>

<li><p><code>tearDown()</code> is called even if your test methods fail or error out.</p></li>
</ul>

<p>And there you have it! Django makes testing even non-ORM datasources a snap, if you know how to wire it up.
<strong>UPDATE:</strong> Some would say that database fixtures and setting up/tearing down database environments as part of your unit tests is not &ldquo;unit testing&rdquo;. This is not entirely accurate, because in order to do unit tests that rely on backend data, you <strong>must</strong> instantiate and tear down pristine database environments.</p>

    </div>
    
      <div class="pagination">
        <div class="pagination__title">
          <span class="pagination__title-h">Read other posts</span>
          <hr />
        </div>
        <div class="pagination__buttons">
          
            <span class="button previous">
              <a href="https://belchak.com/post/2011/03/04/workfit-standing-desk/">
                <span class="button__icon">←</span>
                <span class="button__text">workfit standing desk</span>
              </a>
            </span>
          
          
            <span class="button next">
              <a href="https://belchak.com/post/2011/02/05/unit-testing-your-django-application/">
                <span class="button__text">unit testing your django application</span>
                <span class="button__icon">→</span>
              </a>
            </span>
          
        </div>
      </div>
    

    

  </div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright">
        <span>© 2019 Powered by <a href="http://gohugo.io">Hugo</a></span>
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
    
  </div>
</footer>

<script src="https://belchak.com/assets/main.js"></script>
<script src="https://belchak.com/assets/prism.js"></script>

  
</div>

</body>
</html>
